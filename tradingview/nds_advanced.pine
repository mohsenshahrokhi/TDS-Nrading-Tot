// @version=5
indicator('NDS Pro Advanced', shorttitle='NDS Pro', overlay=true, precision=4)

// === ØªÙ†Ø¸ÛŒÙ…Ø§Øª NDS ===
nds_length = input.int(50, 'Cycle Length', minval=10, maxval=200)
show_signals = input.bool(true, 'Show Trading Signals')
webhook_url = input.string('http://localhost:5000/webhook/nds', 'Webhook URL')

// === Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù…ÙˆØ¬ Ù‚ÛŒÙ…Øª NDS ===
price_wave = (high + low + close * 2) / 4
wave_momentum = ta.roc(price_wave, 1)

// === Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú†Ø±Ø®Ù‡â€ŒÙ‡Ø§ÛŒ NDS ===
pivot_high = ta.pivothigh(high, 2, 2)
pivot_low = ta.pivotlow(low, 2, 2)

// === Ø´Ø±Ø§ÛŒØ· Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ===
sma_fast = ta.sma(close, 10)
sma_slow = ta.sma(close, 20)
trend_direction = sma_fast > sma_slow

buy_signal = pivot_low and trend_direction and close > open
sell_signal = pivot_high and not trend_direction and close < open

// === Ø±Ø³Ù… Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ ===
plotshape(buy_signal and show_signals, "NDS Buy", shape.triangleup, 
          location.belowbar, color=color.new(color.green, 0), size=size.normal)
plotshape(sell_signal and show_signals, "NDS Sell", shape.triangledown, 
          location.abovebar, color=color.new(color.red, 0), size=size.normal)

// === Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ ÙˆØ¨â€ŒÙ‡ÙˆÚ© ===
alertcondition(buy_signal, "NDS Buy Alert", 
  "NDS Ø®Ø±ÛŒØ¯: {{ticker}} - Ù‚ÛŒÙ…Øª: {{close}} - Ø²Ù…Ø§Ù†: {{time}}")
alertcondition(sell_signal, "NDS Sell Alert", 
  "NDS ÙØ±ÙˆØ´: {{ticker}} - Ù‚ÛŒÙ…Øª: {{close}} - Ø²Ù…Ø§Ù†: {{time}}")

// === Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ===
var table info_table = table.new(position.top_right, 3, 5, 
  bgcolor=color.new(color.white, 80), border_width=1)

if barstate.islast
    table.cell(info_table, 0, 0, "ðŸŽ¯ NDS PRO", 
               bgcolor=color.blue, text_color=color.white)
    table.cell(info_table, 1, 0, "ACTIVE", 
               bgcolor=color.green, text_color=color.white)
    
    table.cell(info_table, 0, 1, "Momentum:", text_color=color.orange)
    table.cell(info_table, 1, 1, str.tostring(wave_momentum, "#.#####"))
    
    table.cell(info_table, 0, 2, "Trend:", 
               text_color=trend_direction ? color.green : color.red)
    table.cell(info_table, 1, 2, trend_direction ? "BULLISH" : "BEARISH")
    
    table.cell(info_table, 0, 3, "Buy Signals:", text_color=color.green)
    table.cell(info_table, 1, 3, str.tostring(ta.cum(buy_signal ? 1 : 0)))
    
    table.cell(info_table, 0, 4, "Sell Signals:", text_color=color.red)
    table.cell(info_table, 1, 4, str.tostring(ta.cum(sell_signal ? 1 : 0)))
